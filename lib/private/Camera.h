#ifndef CAM_h
#define CAM_h

#define packetSize      3
#define CAMERA_BAUDRATE 115200

#include "config.h"
#include <Arduino.h>
#include <HardwareSerial.h>
#include <elapsedMillis.h>

class Camera {
    public:
        Camera(HardwareSerial &CAM_SERIAL, int tx, int rx);
        void setup();
        void read();

        void orbit();
        bool aim();
        void updateBot();

        bool ballCap();
        bool goalInField();
        bool ballInField();

        bool ballStationary();
        void shadowBall();
        void getDeltaBall();

        float delta_ball_x, delta_ball_y;
        float dir, spd = DEFAULT_SPEED;

    private:
        HardwareSerial &_CAM_SERIAL;
        int             packetIdx = packetSize - 1;
        int             cameraBuffer[packetSize];

        int _tx, _rx;

        void setGoal();

        bool ball_, yellow_goal, blue_goal;
        byte ball_dist, yellow_dist, blue_dist;
        int  ball_dir, yellow_dir, blue_dir;

        elapsedMillis ballTimer;

        int   min_px = 20, max_px = 60;
        int   max_range   = (max_px - min_px) - 1;
        float distMap[40] = {11.514000000000003,
                            11.327399999999997,
                            11.173800000000007,
                            11.067599999999999,
                            11.023200000000003,
                            11.055000000000014,
                            11.177399999999999,
                            11.404800000000002,
                            11.75160000000001,
                            12.232199999999992,
                            12.861000000000004,
                            13.652399999999986,
                            14.620800000000003,
                            15.780599999999993,
                            17.146200000000007,
                            18.732,
                            20.552400000000006,
                            22.621800000000007,
                            24.9546,
                            27.56520000000002,
                            30.468000000000004,
                            33.677400000000006,
                            37.20779999999999,
                            41.073599999999985,
                            45.28920000000004,
                            49.869,
                            54.82739999999998,
                            60.17880000000004,
                            65.9376,
                            72.1182,
                            78.73500000000006,
                            85.80239999999999,
                            93.33479999999997,
                            101.3466,
                            109.8522,
                            118.86599999999997,
                            128.40240000000003,
                            138.4758,
                            149.10059999999996,
                            160.29120000000003};
    //    float distMap[40] =
    //    {9.924245816042003, 11.264350830336753, 12.281476844998792, 13.06721182976321,
    //    13.709267069299926, 14.28809720060326, 14.874177591060743, 15.52593905718652,
    //    16.288359924039696, 17.192215425309655, 18.253984444071534, 19.476413594221412,
    //    20.84973864259439, 22.353563271730536, 23.959395183332504, 25.63383954241499,
    //    27.34244976207492, 29.054235628999322, 30.746828769586273, 32.4123054567915,
    //    34.06366675762274, 35.74197602129425, 37.524153708091035, 39.53142955888711,
    //    41.93845210532368, 44.983055520688595, 48.97668381144695, 54.31547234947766,
    //    61.49198674492504, 71.1076190597712, 83.8856413621279,
    //    100.68491662104043, 122.51426694217935, 150.54749914397803,
    //    186.13908767472572, 230.84051486998328, 286.4172685509907,
    //    354.86649696362974, 438.4353210579118, 539.6398041084374};
};
#endif
